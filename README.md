# docustyler

📖印刷媒体に携わる編集者向けの🧹 **縦書き・横書き書式の全角半角スタイリング** および🔍️ **媒体ごとの用語の統一** をzsh＆Perlで🎯一括処理するツールです。

---

## ✨Features（特長）✨

📖雑誌や書籍など、縦書きのレイアウトにあわせて原稿を整える作業は、結構労力かかりますよね。💦  
しっかりチェックして直したつもりでも、見落としや入力ミスで、DTP出力を見たら「あ、しまった！」😱なんてことありますよね。

💻 横書きの媒体でも「1桁数字だけ全角」や「英数字は全部半角」など、媒体ごとにルールは様々。そのルールを頭に入れながら、アルファベットや数字を追いかけるのは😵苦行ですよね。  
さらに厄介なのが用語表記。「どっちだっけ？」🤔と過去号を引っ張り出したり、頼んでも頼んでも独特な表記で上がってくる👴大先生の原稿……。  
そんな煩わしさを🚀解決します！

### 縦書きで見落としがちな数字2桁
📄縦書きでは「31日」など **2桁の数字だけ半角** にし、それ以外は「７月」や「２０２５年」「１５０周年」のように全角で表記するのがルール。2桁の数字だけを徹底して探すのは、👀集中力と疲れ目との戦いになり、大抵の場合は敗北します……。😩  
docustylerでは「縦書きモード」では、アルファベット・数字・記号を全角にし、 **2桁の数字だけは自動で半角** に統一、見落としなし！

### 横書きでも全角数字を使う媒体対応
- 横書きの場合でも、📖雑誌のキャプションなどでは1桁数字は全角というルールも多くあります。  
docustylerの横書きモードでは、全角1桁数字は全角、中黒「・」やカッコなどの記号類も全角に統一。一方、小数点と数字のカンマは半角に統一して、媒体ルールに自然と✅フィット。

### 半角英数モードは、4桁以上の数字に桁区切りカンマを自動挿入
- 英数字をすべて半角に統一する半角モードでは、🔢小数点やカンマも半角に統一。さらに4桁以上の数字には「1,000万円」のように桁区切りのカンマを自動挿入して統一します。ただし、「2025年」のように年号を表す時は区切りは挿入されません。💖

### スポーツ系の記事で頭を悩ますタイム表記にも対応
- 🏎️「1分5秒がターゲットタイム」や「4秒台を狙いたいですね」、「4秒321をたたき出す」。原稿上では違和感がなくても、いざ誌面で並ぶと「12秒345」と桁が揃わず👀違和感を感じたことはありませんか？  
docustylerは **縦・横・半角どのモードでも自動で2桁に統一** するので「1分05秒がターゲットタイム」、「04秒台を狙いたいですね」、「04秒321をたたき出す」と表記がきれいに✨揃います。

### 変更可能な用語辞書で、プロジェクト別の表記管理が自由自在
- 用語統一の辞書ファイルは✨シンプルなタブ区切りテキストファイル。  
用語の追加、削除、変更といったメンテナンスが👍楽チン。
- 複数の辞書ファイルの作成・使用も可能。  
起動時に使用する辞書を指定できるので、複数の媒体を抱える大忙しな😵編集さんも、表記ルールでこんがらがってしまう悩みとはおさらばです。😌

- ⚠️注意：このスクリプトは自分用に作成し、その限りにおいては問題なく動作しましたが、このスクリプトを使用した結果、**トラブルや不具合が生じても責任は取れません**ことを理解していただいた上でご使用ください。
- 同業の方（に限らず）、別の使用例や改変アイディアなど共有いただけると幸いです。

---

## 🔧Requirements（要件）🔧

- macOS（zsh）のターミナル（アプリケーション＞ユーティリティの中にターミナル.appがあります）
- zshのファイルを実行し、zshから一部の処理をPerlで実行しています。
- 特に追加でインストールするようなことは必要ありません。  

---

## 🚀Usage（使用方法）🚀
- ターミナルを起動し、以下のように入力して実行します。  
⚠️ 初めて起動する時には以下、「補足」の※1を、用語辞書については「辞書について」の※2を参照してください  
**ユーザー名@ホスト（PC）名 ~ % ./docustyler.zsh 【入力ファイル】 ［辞書ファイル（指定しない場合は用語統一はパス）］【縦または横または半】**  
※「docustyler.zsh」、入力ファイル、辞書ファイルは直接入力しなくても、それぞれターミナル上にドラッグ＆ドロップ＋↩️リターンキーでスタートできます。

### 実行例
- 例えば、入力ファイルが「原稿.txt」、辞書ファイルが「dic_辞書.txt」、縦書きモードで統一を行いたい場合は、  
**% ./docustyler.zsh 原稿.txt dic_辞書.txt 縦**  
を入力し↩️リターンキーを押します。横書きモードの場合は「横」、半角モードの時は「半」とそれぞれ漢字一文字で指定します。

### 出力例
- 処理中は以下のように進行表示あれます  
🧹クリーニング実行中... ✏️縦モードで変換中... 📚 用語統一処理中...
✅️処理完了： 原稿_converted{縦}.txt を出力しました

- 全角・半角のスタイリング統一、用語統一を終えたファイルは、入力ファイルと同じ階層に原稿ファイル名末尾にモード別に  
「_comverted{縦}」「_comverted{横}」「_comverted{半}」とつけられて保存されます。

### 補足
- ※1 初めて使用する際には、**スクリプトの実行権限の付与**が必要になります。ターミナル上で  
**ユーザー名@ホスト（PC）名 ~ % chmod +x （ここにdocustyler.zshのファイルをドラッグ＆ドロップ）**  
して↩️リターンキーを押してください。  
docustyler.zsh（と関連する拡張子が.plのファイル）を別の場所に移動させた時は、再度実行権限を付与してください。

### 各ファイルの内容
- **docustyler.zsh**：メインの実行スクリプト。上記Usageに記載の通り実行させます。

- **normalize_ascii.pl**：入力ファイルの初期処理を行います。

- **convert_fullwidth.pl**：縦書きモード用に全角処理を行います。

- **convert_number.pl**：縦書きモードで2桁数字を半角に統一処理を行います。

- **convert_digit_and_symbol.pl**：横書きモード用に1桁数字を全角に残して、英数字を半角に統一するファイルです。

- **convert_symbol_only.pl**：半角モード用に英数字の半角統一、年号以外の4桁以上の数字の桁区切りを加える処理を行います。

- **replace_terms.pl**：辞書ファイルを元に用語統一処理を行います。

- **dic_SAMPLE.txt**：サンプル用の辞書です。ご自身の使用状況にあわせ編集して使用してください。  
記載の変換規則に則って用語が統一されます。ファイルを複数使用することでプロジェクトごとの用語統一が可能になります。辞書の取り扱いについては、次項「辞書について」をご覧ください。

### 辞書について
- **dic_SAMPLE.txt** の内容を例に説明します。  
- 辞書ファイルはタブ区切りのテキストファイルで、3列構成です。
- 先頭に `#` が付いた行はコメント行で、メモや無効化に使えます。

| 1列目 (タグ) | 2列目 (検索する用語) | 3列目 (変換後の用語) |
| ------------ | ------------------- | ------------------- |
| `P` / `R` / （空欄） | 対象の単語          | 置き換える単語       |

1列目は「P」または「R」のタグ付けし、変換保護の処理を行います。（使用法は後述します）
2列目は、変換候補の用語を登録する列です。
3列目が、変換させたい正しい用語を登録する列です。

#### 通常変換  
dic_SAMPLE.txtの５行目のように  
1列目を空欄にしておくと通常変換になります。  
入力ファイル内の「ギア」が「ギヤ」に統一されます。  
dic_SAMPLE.txt内の８行目以降の1列目が空欄の行についても同様に処理されます。

#### 保護変換  
「ギア」→「ギヤ」と統一したいものの、「レーシングギア」のみ末尾を「ギア」と残したい場合に「レーシングギヤ」と変換されないように**保護する**ためのマーキングをします。 
- 1列目をサンプル辞書6行目のように「P」（プロテクトのP）と設定  
2列目に保護したい用語の「レーシングギア」を指定  
3列目に保護のためのマーキングとして「[[RG]]」と設定をしました。※マーキングは**通常変換で変換対象とならない用語を指定してください** 。もし、通常変換の2列目に [[RG]] が登録されていると、そこで変換されてしまい、別の用語に置き換わってしまいます。

- [[RG]]をレーシングギアに戻す処理は  
1列目に「R」と設定された行（サンプル辞書7行目）で復元（Restore）されます  
2列目の「[[RG]]」は  
3列に「レーシングギア」と登録された通りに元に戻されます。

- サンプルファイルの15行目、16行目も同様に「タイア」→「タイヤ」だけど、「リタイア」の場合だけ語尾が「ア」になる場合の保護を指定しています。  

⚙️変換は次の順序で処理されます：
1. `P`（保護）で置換して守る  
2. 通常変換（空欄の行）でまとめて変換  
3. `R`（リストア）で元に戻す

- ⚠️注意：こ辞書内での登録の順番は、通常変換、P、Rは自由ですが、
- 同じ `P` / 通常変換 / `R` の中では **上に書かれたものが先に処理される** ので、P同士、通常変換同士、R同士の記載順によっては、意図と違う用語統一がされる場合がありますので気をつけてください。
